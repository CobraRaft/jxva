<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>jxva Bot</title>
  <link rel="stylesheet" href="css/style.css" />
</head>
<body>
  <div class="glow"></div>

  <nav class="navbar" id="navbar">
    <div class="logo">jxva</div>
    <div class="nav-links">
      <a href="commands.html">Commands</a>
      <a href="support.html">Support</a>
      <a class="login-btn" id="loginBtn">Login</a>
    </div>
  </nav>

  <main>
    <h1 class="floating">jxva</h1>
    <p>Meet <strong>jxva</strong> — a Discord bot built by <strong>@neporrex_</strong>!<br>From moderation to automation.</p>
    <a class="button" href="invite.html">Invite jxva</a>
  </main>

  <footer>© 2025 jxva — Made by @Neporrex × Vercel.</footer>

  <script>
    const clientId = "1425450445140393994";
    const redirectUri = "https://jxva.vercel.app";
    const loginUrl = `https://discord.com/oauth2/authorize?client_id=${clientId}&response_type=code&redirect_uri=${encodeURIComponent(redirectUri)}&scope=identify+guilds`;

    const params = new URLSearchParams(window.location.search);
    const code = params.get("code");

    async function handleLogin() {
      const loginBtn = document.getElementById("loginBtn");

      // if redirected from Discord
      if (code) {
        try {
          const res = await fetch(`/api/auth?code=${code}`);
          const user = await res.json();
          localStorage.setItem("jxvaUser", JSON.stringify(user));

          // Clean URL
          window.history.replaceState({}, document.title, redirectUri);
          renderNavbar(user);
        } catch (err) {
          console.error("Login failed", err);
        }
      } else {
        const user = JSON.parse(localStorage.getItem("jxvaUser") || "null");
        renderNavbar(user);
      }

      loginBtn.onclick = () => (window.location.href = loginUrl);
    }

    function renderNavbar(user) {
      const navbar = document.getElementById("navbar");
      if (user) {
        navbar.innerHTML = `
          <div class="logo">jxva</div>
          <div class="nav-links">
            <a href="commands.html">Commands</a>
            <a href="support.html">Support</a>
            <div class="user-info">
              <img src="https://cdn.discordapp.com/avatars/${user.id}/${user.avatar}.png" alt="avatar">
              <span>${user.username}</span>
              <a class="login-btn" href="dashboard.html">Dashboard</a>
            </div>
          </div>
        `;
      }
    }

    handleLogin();
  </script>
</body>
</html>
